= Permissions
:navtitle: 权限

您能想到的与 OpenShift 环境的几乎每次交互都需要通过 OpenShift 的控制平面 API。所有 API 交互都经过身份验证（AuthN - 你是谁？）和授权（AuthZ - 你可以做你要求的事情吗？）。

[NOTE]
====
什么是身份验证（authn）？ 身份验证意味着确保一个人或设备是他们声称的人（或什么人）。 领取活动门票的人可能会被要求出示身份证以验证身份； 类似地，应用程序或数据库可能希望通过检查用户的身份来确保用户的合法性。 身份验证确保数据不会暴露给错误的人。

什么是授权（authz）？ 授权决定了经过身份验证的用户可以看到和执行的操作。 想想当银行客户在线登录他们的帐户时会发生什么。 因为他们的身份已经过验证，他们可以看到自己的账户余额和交易历史——但他们无权查看其他人的。 相反，银行的经理可以被授权查看任何客户的财务数据。 同样，一个人可能是一家企业的合法员工，他们可能已经验证了自己的身份，但这并不意味着他们应该有权访问该企业的所有文件和数据。 例如，来自人力资源或会计部门以外的员工不应该能够看到每个人的薪酬。 用户的授权级别决定了他们有权做什么； 因此，授权操作的通用术语是“权限permissions”。 这个概念的另一个术语是“特权privileges”。
====

在上一个查看日志实验中，我们看到引用Service Account 时出现错误。

由于 OpenShift 是一个声明式平台，因此某些操作将由平台执行，而不是由最终用户（当他或她发出命令时）执行。这些操作是使用服务帐户执行的，服务帐户是user平台将在内部使用的一种特殊类型。这些操作是使用服务帐户执行的， Service Account是平台在内部使用的一种特殊类型的“用户”。

OpenShift 会在每个项目中自动创建一些特殊的服务帐户。在默认的服务帐户是一个正在运行的吊舱的责任，OpenShift用途和注入此服务帐户为每一个被推出吊舱。通过更改该服务帐户的权限，我们可以做一些有趣的事情。

OpenShift automatically creates a few special service accounts in every project.
The **default** service account is the one taking the responsibility of running the pods, and OpenShift uses and injects this service account into
every pod that is launched. By changing the permissions for that service
account, we can do interesting things.

您可以在 Web 控制台中查看当前权限，转到 Developer Perspective 中的 Topology 视图，单击parksmap条目，转到Details选项卡，然后单击Namespace。

image::parksmap-permissions-namespace.png[Namespace]

然后，选择角色绑定*Role Bindings* 选项卡并按命名空间角色绑定*Namespace Role Binding*进行过滤，以便查看所选项目的所有权限。

image::parksmap-permissions-membership.png[Membership]

[#grant_serviceaccount_view_permissions]
== 练习：授予服务帐户查看权限
该parksmap应用程序想要交谈的OpenShift API了解其他 吊舱，服务的范围内，和资源项目。你很快就会知道为什么！The parksmap application wants to talk to the OpenShift API to learn about other
*Pods*, *Services*, and resources within the *Project*. You'll soon learn why!

parkmap 应用程序在集群上的项目中作为服务帐户运行：即default 服务帐户。正是对这个服务帐户，我们可以授予必要的“视图”访问权限，这将允许它查询 API 以查看项目中的资源。这还具有解决我们之前在日志中看到的错误消息的原因的额外好处。

通过选择下列选项卡为代表的办法来更新default 服务帐户的%PROJECT%项目Choose an approach represented by the following tabs to update the `default` *Service Account* in the `%PROJECT%` project

[tabs]
====
OpenShift Console::
+
--
. From the *Workloads -> Deployments* page, click on the *Namespace*, then *Role Bindings* and then the *Create Binding* button.
+
image::parksmap-permissions-membership-serviceaccount-list.png[Service account list]
+
. Select *view* for the Role Binding Name *%PROJECT%* for the Namespace, *view* for the Role Name, *Service Account* for the Subject, *%PROJECT%* for the Subject Namespace, and *default* for the Subject Name.
+
image::parksmap-permissions-membership-serviceaccount-edit.png[Service account edit]
+
. Once you're finished editing permissions, click on the *Create* button.  You should then be able to see it on the `Role Bindings` list for the `%PROJECT%` project`
+
image::parksmap-permissions-membership-serviceaccount-done.png[Service account changed]
--
`oc` Command Line::
+
--
[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc project %PROJECT%
----

Then use the `oc policy add-role-to-user` command to give the predefined `view` _role_ to the user:

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc policy add-role-to-user view -z default
----

.What does the `-z` flag do?
****
From the `-h` output on `oc policy`:

[source,bash]
----
-z, --serviceaccount=[]: service account in the current namespace to use as a user
----

The `-z` syntax is a special one that saves us from having to type out the
entire string, which, in this case, is
`system:serviceaccount:%PROJECT%:default`. It's a nifty shortcut.
****

NOTE: The `-z` flag will only work for service accounts in the *current* project.  If you're referring to a service account in a different project, use the `-n <project>`switch.
--
====

[#redeploy_application]
== Exercise: Redeploy Application

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc rollout restart deployment/parksmap
----

A new deployment is immediately started. Return to Topology view and click the `parksmap` entry again to watch it happen. You might not be fast enough! But it will be reflected in the *ReplicaSet* number.

image::parksmap-permissions-redeployed.png[Application deployed]

If you look at the logs for the application now, you should see no errors.  That's great.
