= Routes
:navtitle: 路由Routes 

在本实验中，我们将使最终用户可以看到我们的应用程序，以便他们可以访问它。.

image::roadshow-app-architecture-parksmap-2.png[Application architecture,800,align="center"]

[#routes]
== 背景：路由

虽然服务 service在 OpenShift 环境中提供内部抽象和负载平衡，但有时OpenShift外部的客户端（用户、系统、设备等） 需要访问应用程序。外部客户端能够访问在 OpenShift 中运行的应用程序的方式是通过 OpenShift 路由层。后面的数据对象是Route。

默认的 OpenShift 路由器 (HAProxy) 使用传入请求的 HTTP 标头来确定代理连接的位置。您可以选择为Route定义安全性，例如 TLS 。如果您希望您的Services以及您的Pods可以从外部世界访问，您需要创建一个Route。

[NOTE]
====
Red Hat 是Kubernetes 社区的主要贡献者之一，并将Routes 背后的设计原则贡献给社区，这对 Ingress 设计产生了重大影响。红帽在Openshift中同时支持Ingress和Route。Ingress 和 Route 虽然相似，但在成熟度和功能上存在差异。如果您打算同时在多个 Kubernetes 发行版上部署您的应用程序，那么 Ingress 可能是一个不错的选择，但是本教程不做讨论。您可以通过以下文档，进一步了解。
link:https://cloud.redhat.com/blog/kubernetes-ingress-vs-openshift-route[Kubernetes Ingress 与 OpenShift 路由]
link:https://kubernetes.io/zh/docs/concepts/services-networking/ingress/[Kubernetes参考文档]，
link:https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.8/html/networking/nw-ingress-controller-configuration-parameters_configuring-ingress[红帽ingress文档]
====

[#creating_a_route]
== Exercise: Creating a Route

You may remember that when we deployed the `parksmap` application, we un-checked the checkbox to 
create a *Route*. Normally it would have been created for us automatically. Fortunately, creating a *Route* is a pretty straight-forward process. 

You can create a Route either from the OpenShift Console or using the `oc` CLI.  Use the tabs to choose your desired approach for adding the route.

[tabs]
====
OpenShift Console::
+
--
. Via the *Administrator Perspective*, just click *Networking -> Routes* and then the *Create Route* button.
. Insert *parksmap* in *Name* field.
. From *Service* field, select *parksmap*. For *Target Port*, select *8080*.
. In *Security* section, check *Secure route*. Select *Edge* from *TLS Termination* list.
. Leave all other fields blank and click *Create*:
+
image::parksmap-route-create-1.png[Create Route Part 1,align="center"]
+
image::parksmap-route-create-2.png[Create Route Part 2,align="center"]

TIP: The TLS certificate for cluster Apps domains is used by default, so you don't need to add any certificate. In case you would like a custom domain resolving to OpenShift Nodes hosting Routers, you can add certificates also on a per-route basis.

When creating a *Route*, some other options can be provided, like the hostname and path for the *Route* or the other TLS configurations.

--
`oc` Command Line::
+
--
We are looking to simply `expose` the *Service*, but first we need to verify that we don't already have any existing *Routes*:

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc get routes
----

[.console-output]
[source,bash]
----
No resources found.
----

Now we need to get the *Service* name to expose:

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc get services
----

[.console-output]
[source,bash]
----
NAME       CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
parksmap   172.30.169.213   <none>        8080/TCP   5h
----

Once we know the *Service* name, creating a *Route* is a simple one-command task:

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc create route edge parksmap --service=parksmap
----

[.console-output]
[source,bash]
----
route.route.openshift.io/parksmap exposed
----

--
====

Verify the *Route* was created with the following command:

[.console-input]
[source,bash,subs="+attributes,macros+"]
----
oc get route
----

[.console-output]
[source,bash,subs="+attributes,macros+"]
----
NAME       HOST/PORT                            PATH      SERVICES   PORT       TERMINATION   WILDCARD
parksmap   parksmap-%PROJECT%.%CLUSTER_SUBDOMAIN%             parksmap   8080-tcp   edge          None
----

You can also verify the *Route* in the *Developer Perspective* under the *Resources* tab for your `parksmap` deployment configuration. Also note that there is a decorator icon on the `parksmap` visualization now. If you click that, it will open the URL for your *Route* in a browser.

image::parksmap-route-created.png[Route created]

This application is now available at the URL shown in the Developer Perspective. Click the link and you will see it.

NOTE: If this is the first time opening this page, the browser will ask permission to get your position. This is needed by the Frontend app to center the world map to your location, if you don't allow it, it will just use a default location.

image::parksmap-route-empty-map.png[Empty map]

